<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Kitap ArÅŸivi | Admin Paneli</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#f4f7f6; color: #333; margin:0; padding:20px; }
  header { display:flex; justify-content:space-between; align-items:center; max-width: 800px; margin: 0 auto 20px auto; }
  .box { background:#fff; padding:20px; border-radius:10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); max-width: 800px; margin: 0 auto 15px auto; }
  h2, h3 { margin-top:0; color: #2c3e50; }
  
  /* SayaÃ§ Stili */
  .sayac-box { background: #e8f0fe; color: #1967d2; font-weight: bold; text-align: center; font-size: 1.1em; border: 1px solid #d2e3fc; }
  
  input, button { padding:10px; margin-top:8px; border-radius: 5px; border: 1px solid #ddd; width: 100%; box-sizing: border-box; }
  button { background:#3498db; color:white; border:none; cursor:pointer; font-weight: bold; transition: background 0.3s; }
  button:hover { background: #2980b9; }
  
  #logoutBtn { background: #e74c3c; width: auto; padding: 8px 15px; }
  #logoutBtn:hover { background: #c0392b; }

  .hidden { display:none; }
  
  /* Liste Stili */
  ul { padding:0; list-style:none; max-width: 800px; margin: 20px auto; }
  li { background: #fff; margin-bottom: 8px; padding: 12px 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
  .kitap-metni { font-size: 1.05em; }
  .delete-btn { color:#e74c3c; border:1px solid #e74c3c; background:none; width: auto; margin: 0; padding: 5px 10px; font-size: 0.8em; }
  .delete-btn:hover { background: #fdf2f2; }

  @media (min-width: 600px) {
    .flex-row { display: flex; gap: 10px; align-items: flex-end; }
    .flex-row input { margin-top: 0; }
    .flex-row button { margin-top: 0; width: auto; }
  }
</style>
</head>

<body>

<header>
  <h2>ðŸ“š Kitap ArÅŸivi</h2>
  <button id="logoutBtn">Ã‡Ä±kÄ±ÅŸ Yap</button>
</header>

<div class="box sayac-box" id="toplamGosterge">
  YÃ¼kleniyor...
</div>

<div id="adminPanel" class="box hidden">
  <h3>âž• YÃ¶netici Paneli</h3>
  <div class="flex-row">
    <input id="kitapAdi" placeholder="Yeni kitap adÄ± yazÄ±n...">
    <button id="ekleBtn">Tekli Ekle</button>
  </div>

  <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">

  <div class="flex-row">
    <div style="flex-grow: 1;">
      <label style="font-size: 12px; color: #666;">CSV YÃ¼kle (Her satÄ±ra bir kitap):</label>
      <input type="file" id="csvFile" accept=".csv">
    </div>
    <button id="csvUploadBtn" style="background: #27ae60;">Toplu YÃ¼kle</button>
  </div>
  <p id="csvStatus" style="font-size: 13px; color: #27ae60; margin-top: 10px;"></p>
</div>

<div class="box">
  <div class="flex-row">
    <input id="aramaInput" placeholder="Kitap ismi ile ara...">
    <button id="araBtn">Ara</button>
  </div>
</div>

<ul id="kitapListesi"></ul>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// Sizin Firebase Bilgileriniz
const firebaseConfig = {
  apiKey: "AIzaSyCKYXjtL0jAvcxTD09NzsQelA0ipYQFr0s",
  authDomain: "kitap-arsivi-8efa5.firebaseapp.com",
  projectId: "kitap-arsivi-8efa5",
  storageBucket: "kitap-arsivi-8efa5.firebasestorage.app",
  messagingSenderId: "712225906954",
  appId: "1:712225906954:web:b4e317515cefa3d3c89af3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const ADMIN_EMAIL = "admin@unallar.com";

let tumKitaplar = [];
let isAdmin = false;

// Sayfa yÃ¼klendiÄŸinde kullanÄ±cÄ± kontrolÃ¼
onAuthStateChanged(auth, user => {
  if (!user) {
    location.href = "index.html"; // index-2.html adÄ±nÄ± index.html yaptÄ±ysanÄ±z
  } else {
    isAdmin = user.email === ADMIN_EMAIL;
    if (isAdmin) {
      document.getElementById("adminPanel").classList.remove("hidden");
    }
    kitaplariYukle();
  }
});

// Ã‡Ä±kÄ±ÅŸ Ä°ÅŸlemi
document.getElementById("logoutBtn").onclick = async () => {
  await signOut(auth);
  location.href = "index.html";
};

// VeritabanÄ±ndan kitaplarÄ± Ã§ekme (Koleksiyon: kitaplar)
async function kitaplariYukle(){
  const listeEl = document.getElementById("kitapListesi");
  const sayacEl = document.getElementById("toplamGosterge");
  
  listeEl.innerHTML = "<li>YÃ¼kleniyor...</li>";
  tumKitaplar = [];

  try {
    const snap = await getDocs(collection(db, "kitaplar"));
    snap.forEach(d => {
      tumKitaplar.push({ id: d.id, ad: d.data().ad });
    });

    // Alfabetik sÄ±ralama (A-Z)
    tumKitaplar.sort((a, b) => a.ad.localeCompare(b.ad));

    sayacEl.textContent = `Toplam Kitap SayÄ±sÄ±: ${tumKitaplar.length}`;
    listele(tumKitaplar);
  } catch (err) {
    console.error(err);
    listeEl.innerHTML = "<li>Veriler Ã§ekilirken hata oluÅŸtu.</li>";
  }
}

// Listeyi ekrana basma (1, 2, 3 ÅŸeklinde numaralandÄ±rÄ±lmÄ±ÅŸ)
function listele(liste){
  const listeEl = document.getElementById("kitapListesi");
  listeEl.innerHTML = "";

  liste.forEach((k, index) => {
    const li = document.createElement("li");
    
    // NumaralandÄ±rma index + 1 ile yapÄ±lÄ±r
    li.innerHTML = `<span class="kitap-metni"><strong>${index + 1}.</strong> ${k.ad}</span>`;

    if(isAdmin){
      const b = document.createElement("button");
      b.textContent = "Sil";
      b.className = "delete-btn";
      b.onclick = async () => {
        if(confirm(`"${k.ad}" silinsin mi?`)){
          await deleteDoc(doc(db, "kitaplar", k.id));
          kitaplariYukle();
        }
      };
      li.appendChild(b);
    }
    listeEl.appendChild(li);
  });
}

// Tekli Kitap Ekleme
document.getElementById("ekleBtn").onclick = async () => {
  const input = document.getElementById("kitapAdi");
  const ad = input.value.trim();
  if(!ad || !isAdmin) return;
  
  await addDoc(collection(db, "kitaplar"), { ad });
  input.value = "";
  kitaplariYukle();
};

// Arama Ä°ÅŸlemi
document.getElementById("araBtn").onclick = () => {
  const q = document.getElementById("aramaInput").value.toLowerCase();
  const sonuc = tumKitaplar.filter(k => k.ad.toLowerCase().includes(q));
  listele(sonuc);
};

// CSV Toplu YÃ¼kleme
document.getElementById("csvUploadBtn").onclick = async () => {
  const fileInput = document.getElementById("csvFile");
  const status = document.getElementById("csvStatus");
  const file = fileInput.files[0];
  
  if(!file || !isAdmin) return alert("LÃ¼tfen bir dosya seÃ§in.");

  const text = await file.text();
  const satirlar = text.split("\n");
  const mevcutIsimler = new Set(tumKitaplar.map(k => k.ad.toLowerCase()));

  let eklenen = 0;
  status.textContent = "YÃ¼kleniyor...";

  for(let s of satirlar){
    const ad = s.trim();
    // BoÅŸ satÄ±r deÄŸilse ve sistemde yoksa ekle
    if(ad && !mevcutIsimler.has(ad.toLowerCase())){
      await addDoc(collection(db, "kitaplar"), { ad });
      eklenen++;
    }
  }
  
  status.textContent = `Ä°ÅŸlem tamam! ${eklenen} yeni kitap eklendi.`;
  fileInput.value = "";
  kitaplariYukle();
};
</script>

</body>
</html>
