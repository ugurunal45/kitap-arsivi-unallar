<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KÃ¼tÃ¼phane</title>

<style>
body { font-family: Arial; background:#f4f4f4; padding:15px }
input, select, button { width:100%; padding:10px; margin:6px 0 }
button { background:#2c7be5; color:white; border:none; border-radius:5px }
.kitap { background:white; padding:10px; margin:6px 0; border-radius:5px }
#kamera { display:none; position:fixed; inset:0; background:black; z-index:999 }
video { width:100%; height:100%; object-fit:cover }
.hidden { display:none }
</style>
</head>

<body>

<h2>ğŸ“š KÃ¼tÃ¼phane</h2>

<div id="adminPanel" class="hidden">
  <input id="isbn" placeholder="ISBN">
  <button onclick="kamerayiAc()">ğŸ“· Barkod Oku</button>
  <input id="kitapAdi" placeholder="Kitap adÄ±" readonly>
  <select id="raf">
    <option value="">Raf seÃ§</option>
    <option>Salon</option>
    <option>Ofis</option>
    <option>Ã‡ocuk OdasÄ±</option>
  </select>
  <button onclick="kitapKaydet()">ğŸ’¾ KitabÄ± Kaydet</button>
</div>

<h3>ğŸ“– Kitaplar</h3>
<div id="liste"></div>

<div id="kamera">
  <video id="video" autoplay playsinline></video>
  <button onclick="kamerayiKapat()">Kapat</button>
</div>

<script src="https://unpkg.com/quagga/dist/quagga.min.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ğŸ” ADMIN MAIL */
const ADMIN_EMAIL = "admin@unallar.com";

/* ğŸ”¥ FIREBASE */
const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "PROJECT.firebaseapp.com",
  projectId: "PROJECT_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const kitaplarRef = collection(db, "kitaplar");

/* ğŸ‘¤ ADMIN KONTROL */
onAuthStateChanged(auth, user => {
  if (user && user.email === ADMIN_EMAIL) {
    document.getElementById("adminPanel").classList.remove("hidden");
  }
});

/* ğŸ“· KAMERA */
let stream;
window.kamerayiAc = async () => {
  kamera.style.display = "block";
  stream = await navigator.mediaDevices.getUserMedia({ video:{facingMode:"environment"} });
  video.srcObject = stream;

  Quagga.init({
    inputStream:{ type:"LiveStream", target:video },
    decoder:{ readers:["ean_reader","ean_13_reader"] }
  }, err => { if(!err) Quagga.start(); });

  Quagga.onDetected(d => {
    isbn.value = d.codeResult.code;
    kamerayiKapat();
    isbnAra();
  });
};

window.kamerayiKapat = () => {
  kamera.style.display = "none";
  if(stream) stream.getTracks().forEach(t=>t.stop());
  Quagga.stop();
};

/* ğŸ” ISBN â†’ KÄ°TAP ADI */
async function isbnAra() {
  try {
    const r = await fetch(`https://isbnsearch.org/isbn/${isbn.value}`);
    const t = await r.text();
    const d = new DOMParser().parseFromString(t,"text/html");
    kitapAdi.value = d.querySelector("h1")?.innerText || "BulunamadÄ±";
  } catch {
    alert("Kitap bulunamadÄ±");
  }
}

/* ğŸ’¾ KAYDET */
window.kitapKaydet = async () => {
  if(!isbn.value || !kitapAdi.value || !raf.value) return alert("Eksik bilgi");
  await addDoc(kitaplarRef,{
    isbn:isbn.value,
    kitapAdi:kitapAdi.value,
    raf:raf.value,
    tarih:new Date()
  });
  alert("Kaydedildi");
  listele();
};

/* ğŸ“– LÄ°STE */
async function listele(){
  liste.innerHTML="";
  const s = await getDocs(kitaplarRef);
  s.forEach(d=>{
    const k=d.data();
    liste.innerHTML+=`
      <div class="kitap">
        <b>${k.kitapAdi}</b><br>
        ISBN: ${k.isbn}<br>
        Raf: ${k.raf}
      </div>`;
  });
}
listele();
</script>

</body>
</html>
